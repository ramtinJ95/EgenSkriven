<EXTREMELY_IMPORTANT>
# EgenSkriven Task Tracker for Agents

This project uses **EgenSkriven**, a local-first kanban board for task tracking.
{{if .OverrideTodoWrite}}
**Always use egenskriven instead of TodoWrite to manage your work and tasks.**
**Always use egenskriven instead of writing todo lists.**
{{end}}

All commands support `--json` for machine-readable output.

## Agent Mode: {{.AgentMode}}

{{if eq .AgentMode "autonomous"}}
You have full autonomy to create, update, and complete tasks directly.
Always identify yourself when making changes: use `--agent <your-name>` flag.
The human will review your actions asynchronously via the activity history.
{{else if eq .AgentMode "collaborative"}}
You can execute minor updates (status, priority, labels) directly.
For major actions (completing tasks, deleting), explain your intent and let the human confirm.
Example: "I believe task [id] is complete. Run `egenskriven move [id] done` to confirm."
{{else}}
You are in supervised/read-only mode. You can query tasks and make suggestions.
Output CLI commands for the human to execute. Do not run commands that modify tasks.
{{end}}

## Workflow Mode: {{.WorkflowMode}}

{{if eq .WorkflowMode "strict"}}
### BEFORE starting any task:
1. Check for existing task: `egenskriven list --json --search "keyword"`
2. Create if needed: `egenskriven add "Title" --type <type> --column todo --agent {{.AgentName}} --json`
3. Start work: `egenskriven move <id> in_progress`

### DURING work:
- Keep task description updated with progress
{{if .StructuredSections}}
- Use structured sections in description:
  - `## Approach` - How you plan to implement
  - `## Open Questions` - Uncertainties to resolve
  - `## Checklist` - Steps with checkboxes
{{end}}
- Identify blocking relationships for parallel work

### AFTER completing:
{{if .RequireSummary}}
- Add `## Summary of Changes` section describing what was done
{{end}}
- Mark complete: `egenskriven move <id> done`
- Reference task ID in commits: "feat: implement X [task-id]"
{{else if eq .WorkflowMode "light"}}
### Workflow
- Create task for substantial work: `egenskriven add "Title" --type <type> --agent {{.AgentName}} --json`
- Update status when done: `egenskriven move <id> done`
- Reference task ID in commits when relevant
{{else}}
### Workflow
- Use egenskriven for task tracking as needed
- All commands support `--json` for structured output
{{end}}

## Quick Reference

```bash
# Find ready tasks (unblocked, in todo/backlog)
egenskriven list --json --ready

# Show task details
egenskriven show <id> --json

# Create task (always include --agent to identify yourself)
egenskriven add "Title" --type bug --priority urgent --agent {{.AgentName}} --json

# Move task to different column
egenskriven move <id> in_progress
egenskriven move <id> done

# Update task
egenskriven update <id> --priority high --blocked-by <other-id>

# Get work suggestions
egenskriven suggest --json

# Get project context
egenskriven context --json

# List all tasks
egenskriven list --json

# Filter tasks
egenskriven list --json --column todo --type bug
egenskriven list --json --is-blocked
egenskriven list --json --not-blocked
```

## Task Types
- `bug`: Something broken that needs fixing
- `feature`: New functionality
- `chore`: Maintenance, refactoring, docs

## Priorities
- `urgent`: Do immediately
- `high`: Do before normal work
- `medium`: Standard priority
- `low`: Can be delayed

## Columns
- `backlog`: Not yet planned
- `todo`: Ready to start
- `in_progress`: Currently working
- `review`: Awaiting review
- `done`: Completed

## Blocking Relationships

Use `--blocked-by` to track dependencies:
- `egenskriven update <id> --blocked-by <other-id>` - Mark as blocked
- `egenskriven list --not-blocked` - Find parallelizable work
- `egenskriven list --is-blocked` - See what's waiting
- `egenskriven list --ready` - Unblocked tasks in todo/backlog

## Human-AI Collaborative Workflow

When you need human input to proceed with a task, use the collaborative workflow.

### Before Starting Work

1. **Link your session** to the task:
{{if eq .Tool "opencode"}}
   - Call the `egenskriven-session` tool to get your session ID
   - Run: `egenskriven session link <task-ref> --tool opencode --ref <session-id>`
{{else if eq .Tool "claude-code"}}
   - Your session ID is available as `$CLAUDE_SESSION_ID`
   - Run: `egenskriven session link <task-ref> --tool claude-code --ref $CLAUDE_SESSION_ID`
{{else if eq .Tool "codex"}}
   - Run: `SESSION_ID=$(.codex/get-session-id.sh)`
   - Run: `egenskriven session link <task-ref> --tool codex --ref $SESSION_ID`
{{else}}
   - Get your session ID using the appropriate tool integration
   - Run: `egenskriven session link <task-ref> --tool <tool> --ref <session-id>`
{{end}}

2. **Move task to in_progress**:
   ```bash
   egenskriven move <task-ref> in_progress
   ```

### When You Need Human Input

1. **Block the task** with your question:
   ```bash
   egenskriven block <task-ref> "Your specific question here"
   ```

2. **Your session is preserved**. The human will respond via comments and resume you.

### After Being Resumed

You will receive context that includes:
- Task information (title, priority, description)
- Full comment thread (your question + human responses)
- Instructions to continue

Example context you'll receive:
```
## Task Context (from EgenSkriven)

**Task**: WRK-42 - Implement authentication
**Status**: need_input -> in_progress
**Priority**: high

## Conversation Thread

[agent @ 10:30]: What authentication approach should I use?
[human @ 11:45]: Use JWT with refresh tokens. The refresh token should
have a 7-day expiry, and the access token should be 15 minutes.

## Instructions

Continue working on the task based on the human's response above.
```

### Best Practices

1. **Be specific** in your blocking questions
2. **Provide context** about what you've already considered
3. **List options** if you have multiple approaches in mind
4. **Link your session early** before you might need to block

### Example Workflow

```bash
# 1. Start work
egenskriven session link WRK-42 --tool {{.Tool}} --ref <your-session-id>
egenskriven move WRK-42 in_progress

# 2. Work on the task...

# 3. Encounter a decision point
egenskriven block WRK-42 "The API could use either REST or GraphQL.
REST is simpler but GraphQL offers more flexibility for the frontend.
Which approach should I implement first?"

# 4. Wait for human response (session ends here)

# 5. When resumed, you'll have full context to continue
```

### Checking for Responses

If you want to check for responses without waiting for resume:

```bash
egenskriven comments <task-ref> --json
```
</EXTREMELY_IMPORTANT>
